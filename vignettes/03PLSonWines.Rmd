---
title: "PLSC on Wines"
author: "Vincent Guillemot & HervÃ© Abdi & Ju-Chi Yu & Soudeh Ardestani Khoubrouy"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{PLSC on Wines}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = TRUE, 
  dev = "svg",
  fig.ext = "svg", 
  fig.width = 7, 
  fig.height = 7
)
library(dplyr)
library(knitr)
library(kableExtra)
library(ggplot2)
library(TExPosition)
```

## Load the course library

```{r library, warning = FALSE, message = FALSE}
library(R4SPISE2022)
```

## Load the data

With the following command

```{r winesOf3Colors}
data("winesOf3Colors", package = "data4PCCAR")
```

```{r hidden colors, echo = FALSE}
wineColors <- list()
wineColors$oc <- as.matrix(as.character(recode(winesOf3Colors$winesDescriptors$color, red = 'indianred4', 
                white = 'gold', rose = 'lightpink2')))
wineColors$gc <- as.matrix(c(red = 'indianred4', 
                white = 'gold', rose = 'lightpink2'))

varColors <- list()
varColors$oc[[1]] <- as.matrix(rep("darkorange1", 4))
varColors$oc[[2]] <- as.matrix(rep("olivedrab3", 8))
    
```

## Two tables with descriptors and other supplementary information


```{r four table, echo = TRUE}
descr <- winesOf3Colors$winesDescriptors %>% 
    select(origin, color, varietal)
suppl <- winesOf3Colors$winesDescriptors %>% 
    select(Price)
chemi <- winesOf3Colors$winesDescriptors %>% 
    select(Acidity, Alcohol, Sugar, Tannin)
senso <- winesOf3Colors$winesDescriptors %>% 
    select(fruity, floral, vegetal, 
           spicy, woody, sweet, astringent, 
           hedonic)
```


```{r chemi, eval = FALSE, echo = FALSE, results='asis'}
### First table: chemical data

# fontsize <- 9.

# chemi %>%
#     kable("html", caption = "Table 1: Chemical data") %>%
#     kable_styling("striped", position = "float_left", full_width = F)  %>%
#     row_spec(1:nrow(chemi), 
#     font_size = fontsize) %>%
#     row_spec(0, angle = 0, align = "right", font_size = fontsize)
```


```{r senso, eval = FALSE, echo = FALSE}
### Second table: sensory data
# senso %>%
#     kable("html", caption = "Table 2: Sensory data") %>%
#     kable_styling("striped", position = "left", full_width = F)  %>%
#     row_spec(1:nrow(senso), 
#     font_size = fontsize) %>%
#     row_spec(0, angle = 0, align = "right", font_size = fontsize)
```

### Descriptors and supplementary variable

 * First table: chemical data (`chemi`)
 * Second table: sensory data (`senso`)
 * Descriptors: `origin`, `color` and `varietal`;
 * Suplementary variables: `Price`;
 
## Run PLS-C on the two tables

```{r run}
res.pls <- tepPLS(chemi, senso, DESIGN = descr$color, graphs = FALSE)
```

## Generate the figures

```{r TTA plots, fig.show='hide'}
# library(PTCA4CATA)
# library(data4PCCAR)
res.pls.plot <- TTAplot(
    res = res.pls, # Output of tepPLS
    color.obs = wineColors,
    color.tab = varColors,
    DESIGN = descr$color, # design for the wines
    tab1 = chemi,  # First data table
    tab2 = senso)  # Second data table
# , DESIGN = descr$color
```

### Correlation between the two tables

```{r hetamap.rxy}
res.pls.plot$results.graphs$heatmap.rxy
```

### Scree plot

```{r scree, fig.height = 4}
res.pls.plot$results.graphs$scree.eig
```

### Latent variables

```{r LV map}
res.pls.plot$results.graphs$lv.plot
```

### Contributions

```{r loadings, fig.height = 4}
res.pls.plot$results.graphs$ctrX.plot
res.pls.plot$results.graphs$ctrY.plot
```

### Circles of correlations

```{r corcircles}
res.pls.plot$results.graphs$cirCorX.plot
res.pls.plot$results.graphs$cirCorY.plot
```

